<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Importaciones
import { Jugador } from './classes/Jugador.js';
import { Enemigo } from './classes/Enemigo.js';
import { Jefe } from './classes/Jefe.js';
import { Mercado } from './modules/Mercado.js';
import { Batalla } from './modules/Batalla.js';
import { Ranking } from './modules/Ranking.js';
import { formatearPrecio } from './utils.js';

/**
 * Clase principal que gestiona el flujo del juego "Aventura en el Reino de JS"
 * @class
 */
class Juego {
    /**
     * Crea una instancia del Juego e inicializa todos los componentes
     * @constructor
     */
    constructor() {
        console.log('Constructor de Juego llamado');
        /** @type {Jugador|null} Instancia del jugador */
        this.jugador = null;
        /** @type {Enemigo[]} Array con todos los enemigos del juego */
        this.enemigos = [];
        /** @type {Object[]} Array con los resultados de las batallas realizadas */
        this.batallasRealizadas = [];
        /** @type {number} √çndice de la batalla actual */
        this.batallaActual = 0;
        /** @type {string|null} Rareza con descuento aplicado (si existe) */
        this.rarezaDescuento = null;

        this.inicializarJuego();
    }

    /**
     * Inicializa el juego configurando elementos DOM y eventos
     * @private
     */
    inicializarJuego() {
        console.log('Inicializando juego...');

        try {
            this.inicializarElementosDOM();
            this.inicializarEventos();
            this.iniciarJuego();
            console.log('Juego inicializado correctamente');
        } catch (error) {
            console.error('Error al inicializar el juego:', error);
        }
    }

    /**
     * Inicializa las referencias a los elementos del DOM
     * @private
     */
    inicializarElementosDOM() {
        console.log('Inicializando elementos DOM...');

        // Escenas
        /** @type {NodeList} Lista de todas las escenas del juego */
        this.escenas = document.querySelectorAll('.escena');
        console.log('Escenas encontradas:', this.escenas.length);

        // Botones de navegaci√≥n
        /** @type {HTMLElement} Bot√≥n para continuar desde la escena inicial */
        this.btnContinuarInicio = document.getElementById('btn-continuar-inicio');
        /** @type {HTMLElement} Bot√≥n para continuar desde la escena del mercado */
        this.btnContinuarMercado = document.getElementById('btn-continuar-mercado');
        /** @type {HTMLElement} Bot√≥n para continuar desde la escena de estado */
        this.btnContinuarEstado = document.getElementById('btn-continuar-estado');
        /** @type {HTMLElement} Bot√≥n para continuar desde la escena de enemigos */
        this.btnContinuarEnemigos = document.getElementById('btn-continuar-enemigos');
        /** @type {HTMLElement} Bot√≥n para continuar desde la escena de batallas */
        this.btnContinuarBatallas = document.getElementById('btn-continuar-batallas');
        /** @type {HTMLElement} Bot√≥n para pasar a la siguiente batalla */
        this.btnSiguienteBatalla = document.getElementById('btn-siguiente-batalla');
        /** @type {HTMLElement} Bot√≥n para reiniciar el juego */
        this.btnReiniciar = document.getElementById('btn-reiniciar');

        console.log('Botones encontrados:', {
            inicio: !!this.btnContinuarInicio,
            mercado: !!this.btnContinuarMercado,
            estado: !!this.btnContinuarEstado,
            enemigos: !!this.btnContinuarEnemigos,
            batallas: !!this.btnContinuarBatallas,
            siguiente: !!this.btnSiguienteBatalla,
            reiniciar: !!this.btnReiniciar
        });
    }

    /**
     * Configura los event listeners para los botones y controles del juego
     * @private
     */
    inicializarEventos() {
        console.log('Inicializando eventos...');

        // Bot√≥n Comenzar Aventura
        if (this.btnContinuarInicio) {
            this.btnContinuarInicio.addEventListener('click', () => {
                console.log('¬°Bot√≥n Comenzar Aventura clickeado!');
                this.mostrarEscena('escena-mercado');
            });
        } else {
            console.error('ERROR: No se encontr√≥ el bot√≥n btn-continuar-inicio');
        }

        // Otros botones
        if (this.btnContinuarMercado) {
            this.btnContinuarMercado.addEventListener('click', () => {
                this.mostrarEscena('escena-estado');
            });
        }

        if (this.btnContinuarEstado) {
            this.btnContinuarEstado.addEventListener('click', () => {
                this.mostrarEscena('escena-enemigos');
            });
        }

        if (this.btnContinuarEnemigos) {
            this.btnContinuarEnemigos.addEventListener('click', () => {
                this.iniciarBatallas();
            });
        }

        if (this.btnContinuarBatallas) {
            this.btnContinuarBatallas.addEventListener('click', () => {
                this.mostrarEscena('escena-final');
            });
        }

        if (this.btnSiguienteBatalla) {
            this.btnSiguienteBatalla.addEventListener('click', () => {
                this.siguienteBatalla();
            });
        }

        if (this.btnReiniciar) {
            this.btnReiniciar.addEventListener('click', () => {
                this.reiniciarJuego();
            });
        }

        console.log('Eventos inicializados');
    }

    /**
     * Inicia el juego creando el jugador, enemigos y renderizando los elementos iniciales
     * @private
     */
    iniciarJuego() {
        console.log('Iniciando juego...');

        this.jugador = new Jugador('Cazador', 'assets/images/player.png');

        this.crearEnemigos();

        this.actualizarTarjetaJugador();
        this.renderizarProductos();
        this.renderizarEnemigos();
        this.actualizarEstadisticasMercado();

        console.log('Juego iniciado correctamente');
    }

    /**
     * Crea los enemigos del juego: Goblin, Orco y Drag√≥n (jefe)
     * @private
     */
    crearEnemigos() {
        this.enemigos = [
            new Enemigo('Goblin', 'assets/images/goblin.png', 15, 80),
            new Enemigo('Orco', 'assets/images/orc.png', 25, 120),
            new Jefe('Drag√≥n', 'assets/images/dragon.png', 40, 200, 1.5)
        ];
    }

    /**
     * Muestra una escena espec√≠fica y oculta las dem√°s
     * @param {string} idEscena - ID de la escena a mostrar
     */
    mostrarEscena(idEscena) {
        console.log('Cambiando a escena:', idEscena);

        // Ocultar todas las escenas
        this.escenas.forEach(escena => {
            escena.classList.remove('activa');
        });

        // Mostrar la escena objetivo
        const escenaTarget = document.getElementById(idEscena);
        if (escenaTarget) {
            escenaTarget.classList.add('activa');
            console.log('Escena cambiada exitosamente');
        } else {
            console.error('No se encontr√≥ la escena:', idEscena);
        }

        // Actualizar informaci√≥n espec√≠fica
        if (idEscena === 'escena-estado') {
            this.actualizarEstadoJugador();
        } else if (idEscena === 'escena-final') {
            this.mostrarResultadoFinal();
        }
    }

    /**
     * Actualiza la tarjeta del jugador en la escena inicial con sus estad√≠sticas actuales
     * @private
     */
    actualizarTarjetaJugador() {
        this.actualizarElemento('ataque-jugador', this.jugador.obtenerAtaqueTotal());
        this.actualizarElemento('defensa-jugador', this.jugador.obtenerDefensaTotal());
        this.actualizarElemento('vida-jugador', this.jugador.obtenerVidaTotal());
        this.actualizarElemento('puntos-jugador', this.jugador.puntos);
    }

    /**
     * Actualiza la tarjeta del jugador en la escena de estado actualizado
     * @private
     */
    actualizarEstadoJugador() {
        this.actualizarElemento('ataque-jugador-estado', this.jugador.obtenerAtaqueTotal());
        this.actualizarElemento('defensa-jugador-estado', this.jugador.obtenerDefensaTotal());
        this.actualizarElemento('vida-jugador-estado', this.jugador.obtenerVidaTotal());
        this.actualizarElemento('puntos-jugador-estado', this.jugador.puntos);
    }

    /**
     * Actualiza las estad√≠sticas mostradas en el mercado (ataque, defensa y vida extra)
     * @private
     */
    actualizarEstadisticasMercado() {
        this.actualizarElemento('ataque-total', this.jugador.obtenerAtaqueTotal());
        this.actualizarElemento('defensa-total', this.jugador.obtenerDefensaTotal());

        const bonusVida = this.jugador.inventario
            .filter(item => item.tipo === 'Consumible')
            .reduce((total, consumible) => total + consumible.bonus, 0);
        this.actualizarElemento('vida-extra', bonusVida);
    }

    /**
     * Actualiza el contenido de texto de un elemento del DOM
     * @param {string} id - ID del elemento a actualizar
     * @param {string|number} valor - Nuevo valor para el elemento
     * @private
     */
    actualizarElemento(id, valor) {
        const elemento = document.getElementById(id);
        if (elemento) {
            elemento.textContent = valor;
        }
    }

    /**
     * Renderiza los productos disponibles en el mercado
     * @private
     */
    renderizarProductos() {
        const listaProductos = document.getElementById('lista-productos');
        if (!listaProductos) {
            console.error('No se encontr√≥ lista-productos');
            return;
        }

        listaProductos.innerHTML = '';

        const productos = Mercado.obtenerProductos();

        productos.forEach(producto => {
            const productoElement = document.createElement('div');
            productoElement.className = 'producto';

            const rarezaClase = producto.rareza.toLowerCase();

            productoElement.innerHTML = `
                &lt;div class="producto-imagen-container">
                    &lt;img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.style.display='none'">
                &lt;/div>
                &lt;h4>${producto.nombre}&lt;/h4>
                &lt;p class="producto-bonus">+${producto.bonus} ${this.obtenerTipoBonus(producto.tipo)}&lt;/p>
                &lt;p class="producto-precio">${formatearPrecio(producto.precio)}&lt;/p>
                &lt;p class="rareza ${rarezaClase}">${producto.rareza.toUpperCase()}&lt;/p>
                &lt;p>&lt;small>${producto.tipo}&lt;/small>&lt;/p>
                &lt;button class="btn btn-comprar" data-nombre="${producto.nombre}" data-rareza="${producto.rareza}">A√±adir al Carrito&lt;/button>
            `;
            listaProductos.appendChild(productoElement);
        });

        // Agregar event listeners
        document.querySelectorAll('.btn-comprar').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const nombreProducto = e.target.getAttribute('data-nombre');
                const rarezaProducto = e.target.getAttribute('data-rareza');
                this.manejarCompraProducto(nombreProducto, rarezaProducto, e.target);
            });
        });
    }

    /**
     * Obtiene la etiqueta de bonus seg√∫n el tipo de producto
     * @param {string} tipo - Tipo de producto ('Arma', 'Armadura', 'Consumible')
     * @returns {string} Etiqueta correspondiente al tipo de bonus
     * @private
     */
    obtenerTipoBonus(tipo) {
        switch (tipo) {
            case 'Arma': return 'ATAQUE';
            case 'Armadura': return 'DEFENSA';
            case 'Consumible': return 'VIDA';
            default: return 'BONUS';
        }
    }

    /**
     * Maneja la compra o retiro de un producto del mercado
     * @param {string} nombreProducto - Nombre del producto
     * @param {string} rarezaProducto - Rareza del producto
     * @param {HTMLElement} boton - Elemento del bot√≥n que fue clickeado
     * @private
     */
    manejarCompraProducto(nombreProducto, rarezaProducto, boton) {
        const productos = Mercado.obtenerProductos();

        // Buscar el producto por nombre Y rareza
        const producto = productos.find(p =>
            p.nombre === nombreProducto &amp;&amp; p.rareza === rarezaProducto
        );

        if (!producto) {
            console.error('Producto no encontrado:', nombreProducto, rarezaProducto);
            return;
        }

        const productoElement = boton.parentElement;
        const estaEnCesta = productoElement.classList.contains('seleccionado');

        if (!estaEnCesta) {
            this.jugador.a√±adirObjeto(producto);
            productoElement.classList.add('seleccionado');
            boton.textContent = 'Retirar';
            boton.className = 'btn btn-retirar';

            // Mostrar animaci√≥n de confirmaci√≥n
            this.mostrarAnimacionConfirmacion();
        } else {
            // Buscar y eliminar el producto exacto por nombre y rareza
            const index = this.jugador.inventario.findIndex(item =>
                item.nombre === nombreProducto &amp;&amp; item.rareza === rarezaProducto
            );
            if (index > -1) {
                this.jugador.inventario.splice(index, 1);
            }
            productoElement.classList.remove('seleccionado');
            boton.textContent = 'A√±adir al Carrito';
            boton.className = 'btn btn-comprar';
        }

        this.actualizarCesta();
        this.actualizarTarjetaJugador();
        this.actualizarEstadisticasMercado();
    }

    /**
     * Actualiza la visualizaci√≥n de la cesta de compra/inventario
     * @private
     */
    actualizarCesta() {
        const cesta = document.getElementById('cesta-compra');
        const totalObjetos = document.getElementById('total-objetos');

        if (!cesta) return;

        cesta.innerHTML = '';

        if (this.jugador.inventario.length === 0) {
            cesta.innerHTML = `
                &lt;div class="cesta-vacia">
                    &lt;i class="fas fa-box-open">&lt;/i>
                    &lt;p>Tu inventario est√° vac√≠o&lt;/p>
                &lt;/div>
            `;
            if (totalObjetos) totalObjetos.textContent = '0';
            return;
        }

        this.jugador.inventario.forEach(producto => {
            const itemElement = document.createElement('div');

            // Usar la rareza directamente en min√∫sculas
            const rarezaClase = producto.rareza.toLowerCase();

            itemElement.className = `item-inventario ${rarezaClase}`;

            itemElement.innerHTML = `
                &lt;img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.style.display='none'">
            `;
            cesta.appendChild(itemElement);
        });

        if (totalObjetos) {
            totalObjetos.textContent = this.jugador.inventario.length;
        }
    }

    /**
     * Muestra una animaci√≥n de confirmaci√≥n cuando se a√±ade un producto al carrito
     * @private
     */
    mostrarAnimacionConfirmacion() {
        // Crear elemento de confirmaci√≥n
        const animacion = document.createElement('div');
        animacion.className = 'animacion-confirmacion';
        animacion.textContent = '‚úì A√±adido al carrito';

        document.body.appendChild(animacion);

        // Remover despu√©s de la animaci√≥n
        setTimeout(() => {
            if (document.body.contains(animacion)) {
                document.body.removeChild(animacion);
            }
        }, 1000);
    }

    /**
     * Renderiza los enemigos en la escena de selecci√≥n de enemigos
     * @private
     */
    renderizarEnemigos() {
        const listaEnemigos = document.getElementById('lista-enemigos');
        if (!listaEnemigos) return;

        listaEnemigos.innerHTML = '';

        this.enemigos.forEach((enemigo, index) => {
            const enemigoElement = document.createElement('div');
            const esJefe = enemigo instanceof Jefe;

            enemigoElement.className = `enemigo ${esJefe ? 'jefe' : ''}`;
            enemigoElement.innerHTML = `
                &lt;img src="${enemigo.avatar}" alt="${enemigo.nombre}" onerror="this.style.display='none'">
                &lt;h3>${enemigo.nombre} ${esJefe ? 'üëë' : ''}&lt;/h3>
                &lt;div class="estadisticas-enemigo">
                    &lt;p>&lt;strong>Ataque:&lt;/strong> ${enemigo.ataque}&lt;/p>
                    &lt;p>&lt;strong>Vida:&lt;/strong> ${enemigo.vida}&lt;/p>
                    ${esJefe ? `&lt;p>&lt;strong>Multiplicador:&lt;/strong> ${enemigo.multiplicadorDa√±o}x&lt;/p>` : ''}
                &lt;/div>
                ${esJefe ? '&lt;p class="jefe-label">¬°JEFE FINAL!&lt;/p>' : ''}
            `;
            listaEnemigos.appendChild(enemigoElement);
        });
    }

    /**
     * Inicia la secuencia de batallas
     * @private
     */
    iniciarBatallas() {
        this.mostrarEscena('escena-batallas');
        this.batallaActual = 0;
        this.batallasRealizadas = [];
        this.iniciarBatallaIndividual();
    }

    /**
     * Inicia una batalla individual contra el enemigo actual
     * @private
     */
    iniciarBatallaIndividual() {
        if (this.batallaActual >= this.enemigos.length) {
            this.finalizarBatallas();
            return;
        }

        const enemigo = this.enemigos[this.batallaActual];

        // Preparar interfaz con animaciones
        this.prepararInterfazBatalla(enemigo);

        // Esperar a que terminen las animaciones de entrada antes de iniciar la batalla
        setTimeout(() => {
            this.simularBatallaVisual(enemigo);
        }, 900); // 900ms = 800ms de animaci√≥n + 100ms de margen
    }

    /**
     * Simula una batalla visualmente y actualiza la interfaz con el resultado
     * @param {Enemigo} enemigo - Enemigo contra el que se va a combatir
     * @private
     */
    simularBatallaVisual(enemigo) {
        const resultado = Batalla.combate(enemigo, this.jugador);

        // Actualizar barras de vida
        this.actualizarBarrasVidaVisual(
            resultado.vidaJugadorFinal,
            resultado.vidaEnemigoFinal,
            resultado.vidaMaximaJugador,
            resultado.vidaMaximaEnemigo
        );

        // Mostrar resultado
        this.mostrarResultadoBatalla(resultado, enemigo);

        this.batallasRealizadas.push(resultado);

        // Mostrar botones seg√∫n el resultado
        if (this.btnContinuarBatallas) this.btnContinuarBatallas.style.display = 'none';
        if (this.btnSiguienteBatalla) this.btnSiguienteBatalla.style.display = 'inline-block';

        if (resultado.ganador === 'enemigo') {
            if (this.btnSiguienteBatalla) this.btnSiguienteBatalla.style.display = 'none';
            if (this.btnContinuarBatallas) {
                this.btnContinuarBatallas.style.display = 'inline-block';
                this.btnContinuarBatallas.textContent = 'Continuar al Resultado Final';
            }
        }
    }

    /**
     * Actualiza visualmente las barras de vida del jugador y enemigo
     * @param {number} vidaJugador - Vida actual del jugador
     * @param {number} vidaEnemigo - Vida actual del enemigo
     * @param {number} vidaMaxJugador - Vida m√°xima del jugador
     * @param {number} vidaMaxEnemigo - Vida m√°xima del enemigo
     * @private
     */
    actualizarBarrasVidaVisual(vidaJugador, vidaEnemigo, vidaMaxJugador, vidaMaxEnemigo) {
        // Calcular porcentajes
        const porcentajeJugador = (vidaJugador / vidaMaxJugador) * 100;
        const porcentajeEnemigo = (vidaEnemigo / vidaMaxEnemigo) * 100;

        // Actualizar barras con animaci√≥n
        const barraJugador = document.getElementById('vida-bar-jugador');
        const barraEnemigo = document.getElementById('vida-bar-enemigo');

        barraJugador.style.width = `${porcentajeJugador}%`;
        barraEnemigo.style.width = `${porcentajeEnemigo}%`;

        // Cambiar color si la vida es baja
        if (porcentajeJugador &lt; 30) {
            barraJugador.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
        } else {
            barraJugador.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
        }

        if (porcentajeEnemigo &lt; 30) {
            barraEnemigo.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
        } else {
            barraEnemigo.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
        }

        // Actualizar textos
        document.getElementById('vida-texto-jugador').textContent = `${Math.round(vidaJugador)}/${vidaMaxJugador}`;
        document.getElementById('vida-texto-enemigo').textContent = `${Math.round(vidaEnemigo)}/${vidaMaxEnemigo}`;
    }

    /**
     * Muestra el resultado de una batalla en la interfaz
     * @param {Object} resultado - Resultado de la batalla
     * @param {Enemigo} enemigo - Enemigo contra el que se luch√≥
     * @private
     */
    mostrarResultadoBatalla(resultado, enemigo) {
        const resultadoElement = document.getElementById('resultado-batalla');
        if (!resultadoElement) return;

        if (resultado.ganador === 'jugador') {
            resultadoElement.innerHTML = `
                &lt;div class="victoria-texto">
                    &lt;h3>üéâ ¬°VICTORIA!&lt;/h3>
                    &lt;p>Has derrotado a ${enemigo.nombre}&lt;/p>
                    &lt;p class="puntos-ganados">+${resultado.puntos} puntos&lt;/p>
                &lt;/div>
            `;
            resultadoElement.className = 'resultado-batalla victoria';
        } else {
            resultadoElement.innerHTML = `
                &lt;div class="derrota-texto">
                    &lt;h3>üíÄ ¬°DERROTA!&lt;/h3>
                    &lt;p>${enemigo.nombre} te ha vencido&lt;/p>
                &lt;/div>
            `;
            resultadoElement.className = 'resultado-batalla derrota';
        }
    }

    /**
     * Prepara la interfaz para una nueva batalla con animaciones de entrada
     * @param {Enemigo} enemigo - Enemigo contra el que se va a combatir
     * @private
     */
    prepararInterfazBatalla(enemigo) {
        document.getElementById('avatar-batalla-jugador').src = this.jugador.avatar;
        document.getElementById('nombre-batalla-jugador').textContent = this.jugador.nombre;
        document.getElementById('avatar-batalla-enemigo').src = enemigo.avatar;
        document.getElementById('nombre-batalla-enemigo').textContent = enemigo.nombre;

        const vidaJugadorMax = this.jugador.obtenerVidaTotal();
        document.getElementById('vida-texto-jugador').textContent = `${vidaJugadorMax}/${vidaJugadorMax}`;
        document.getElementById('vida-texto-enemigo').textContent = `${enemigo.vida}/${enemigo.vida}`;

        // Resetear barras al 100%
        document.getElementById('vida-bar-jugador').style.width = '100%';
        document.getElementById('vida-bar-enemigo').style.width = '100%';
        document.getElementById('vida-bar-jugador').style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
        document.getElementById('vida-bar-enemigo').style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';

        // Limpiar resultado anterior
        const resultadoElement = document.getElementById('resultado-batalla');
        if (resultadoElement) {
            resultadoElement.innerHTML = '&lt;p>‚öîÔ∏è La batalla est√° por comenzar...&lt;/p>';
            resultadoElement.className = 'resultado-batalla';
        }

        // Obtener elementos de combatientes
        const jugadorCombatiente = document.querySelector('.jugador-combatiente');
        const enemigoCombatiente = document.querySelector('.enemigo-combatiente');

        // Reiniciar animaciones - FORZAR re-aplicaci√≥n
        jugadorCombatiente.style.animation = 'none';
        enemigoCombatiente.style.animation = 'none';

        // Forzar reflow para reiniciar animaciones
        void jugadorCombatiente.offsetWidth;
        void enemigoCombatiente.offsetWidth;

        // Aplicar animaciones de entrada
        jugadorCombatiente.style.animation = 'slideInFromLeft 0.8s ease-out forwards';
        enemigoCombatiente.style.animation = 'slideInFromRight 0.8s ease-out forwards';

        if (this.btnContinuarBatallas) this.btnContinuarBatallas.style.display = 'none';
        if (this.btnSiguienteBatalla) this.btnSiguienteBatalla.style.display = 'none';
    }

    /**
     * Avanza a la siguiente batalla en la secuencia
     * @private
     */
    siguienteBatalla() {
        this.batallaActual++;
        this.iniciarBatallaIndividual();
    }

    /**
     * Finaliza la secuencia de batallas y actualiza la interfaz
     * @private
     */
    finalizarBatallas() {
        if (this.btnSiguienteBatalla) this.btnSiguienteBatalla.style.display = 'none';
        if (this.btnContinuarBatallas) {
            this.btnContinuarBatallas.style.display = 'inline-block';
            this.btnContinuarBatallas.textContent = 'Ver Resultado Final';
        }
    }

    /**
     * Muestra el resultado final del juego con puntuaci√≥n y rango
     * @private
     */
    mostrarResultadoFinal() {
        this.actualizarElemento('puntos-final', this.jugador.puntos);

        const rango = Ranking.distinguirJugador(this.jugador.puntos);
        const rangoElement = document.getElementById('rango-final');
        if (rangoElement) {
            rangoElement.textContent = rango;

            if (rango === 'Veterano') {
                rangoElement.classList.add('veterano');
                this.lanzarConfeti();
            } else {
                this.lanzarConfetiSimple();
            }
        }

        this.mostrarResumenBatallas();
    }

    /**
     * Lanza una animaci√≥n de confeti especial para cuando el jugador alcanza el rango de Veterano
     * @private
     */
    lanzarConfeti() {
        const duration = 3 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function randomInRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function () {
            const timeLeft = animationEnd - Date.now();

            if (timeLeft &lt;= 0) {
                return clearInterval(interval);
            }

            const particleCount = 50 * (timeLeft / duration);

            confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
            });

            confetti({
                ...defaults,
                particleCount,
                origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
            });
        }, 250);

        setTimeout(() => {
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff']
            });
        }, 500);
    }

    /**
     * Lanza una animaci√≥n simple de confeti
     * @private
     */
    lanzarConfetiSimple() {
        confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 }
        });
    }

    /**
     * Muestra un resumen detallado de todas las batallas realizadas
     * @private
     */
    mostrarResumenBatallas() {
        const resumenElement = document.getElementById('resumen-combates');
        if (!resumenElement) return;

        resumenElement.innerHTML = '';

        this.batallasRealizadas.forEach((batalla, index) => {
            const enemigo = this.enemigos[index];
            const batallaElement = document.createElement('div');
            batallaElement.className = 'resumen-batalla';
            batallaElement.innerHTML = `
                &lt;h4>Batalla ${index + 1}: vs ${enemigo.nombre}&lt;/h4>
                &lt;p>&lt;strong>Resultado:&lt;/strong> ${batalla.ganador === 'jugador' ? '‚úÖ Victoria' : '‚ùå Derrota'}&lt;/p>
                &lt;p>&lt;strong>Puntos obtenidos:&lt;/strong> ${batalla.puntos}&lt;/p>
            `;
            resumenElement.appendChild(batallaElement);
        });
    }

    /**
     * Reinicia el juego a su estado inicial
     * @private
     */
    reiniciarJuego() {
        this.jugador = new Jugador('Cazador', 'assets/images/player.png');
        this.crearEnemigos();
        this.actualizarTarjetaJugador();
        this.renderizarProductos();
        this.actualizarCesta();
        this.actualizarEstadisticasMercado();
        this.mostrarEscena('escena-inicio');
    }
}

// Inicializar el juego
document.addEventListener('DOMContentLoaded', () => {
    new Juego();
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Batalla.html">Batalla</a></li><li><a href="module-Mercado.html">Mercado</a></li><li><a href="module-Ranking.html">Ranking</a></li><li><a href="module-constants.html">constants</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="Enemigo.html">Enemigo</a></li><li><a href="Jefe.html">Jefe</a></li><li><a href="Juego.html">Juego</a></li><li><a href="Jugador.html">Jugador</a></li><li><a href="Producto.html">Producto</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 03 2025 00:08:55 GMT+0100 (hora est√°ndar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
